# DOWNLOAD LATEST UBUNTU LTS # ---------------------------------------------------------------------------------------------------------------------------- #
FROM ubuntu:latest
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


ENTRYPOINT ["/bin/sh"]

# SET VARIABLE FOR APT # ---------------------------------------------------------------------------------------------------------------------------------- #
ENV DEBIAN_FRONTEND=noninteractive 
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# CHANGE REPOSITORIES # ----------------------------------------------------------------------------------------------------------------------------------- #
RUN echo 'deb [arch=amd64] http://ayene.mahsan.net/ubuntu/ focal main restricted universe multiverse'            > /etc/apt/sources.list
RUN echo 'deb [arch=amd64] http://ayene.mahsan.net/ubuntu/ focal-updates main restricted universe multiverse'   >> /etc/apt/sources.list
RUN echo 'deb [arch=amd64] http://ayene.mahsan.net/ubuntu/ focal-security main restricted universe multiverse'  >> /etc/apt/sources.list
RUN echo 'deb [arch=amd64] http://ayene.mahsan.net/ubuntu/ focal-backports main restricted universe multiverse' >> /etc/apt/sources.list
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# ADD PROXY FOR REPOSITORIES # ---------------------------------------------------------------------------------------------------------------------------- #
# RUN echo 'Acquire::http::proxy "http://192.168.88.106:3128";'   > /etc/apt/apt.conf.d/00proxy.conf
# RUN echo 'Acquire::https::proxy "http://192.168.88.106:3128";' >> /etc/apt/apt.conf.d/00proxy.conf
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# UPDATE AND UPGRADE PACKAGES # --------------------------------------------------------------------------------------------------------------------------- #
RUN apt-get update
RUN apt-get dist-upgrade -y
RUN apt autoremove -y
RUN apt-get clean
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# INSTALL SOME PACKAGES # --------------------------------------------------------------------------------------------------------------------------------- #
RUN apt-get install vim nano htop net-tools p7zip-full lsb-release git openssh-server -y 
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# ENABLE ROOT LOGIN IN SSH # ------------------------------------------------------------------------------------------------------------------------------ #
RUN echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# CHANGE policy-rc.d FILE # ------------------------------------------------------------------------------------------------------------------------------- #
RUN printf '#!/bin/sh\nexit 0' > /usr/sbin/policy-rc.d
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# CHANGE ROOT PASSWORD # ---------------------------------------------------------------------------------------------------------------------------------- #
RUN echo 'root:a' | chpasswd
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# COPY FILES TO CONTAINER # ------------------------------------------------------------------------------------------------------------------------------- #
COPY openldap.installer.conf /root/
COPY openldap.server.installer.sh /root/
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# UNSET DEBIAN_FRONTEND VARIABLE # ------------------------------------------------------------------------------------------------------------------------ #
RUN echo 'unset DEBIAN_FRONTEND' >> /root/.bashrc
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #


# SET INIT AS PID 1 ## SET INIT AS PID 1 ## SET INIT AS PID 1 # ------------------------------------------------------------------------------------------- #
CMD [ "/sbin/init" ]
# --------------------------------------------------------------------------------------------------------------------------------------------------------- #
